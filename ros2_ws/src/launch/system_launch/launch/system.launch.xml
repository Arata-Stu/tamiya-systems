<launch>
    <arg name="record" default="false" description="run rosbag2 record node"/>
    <arg name="use_lidar" default="true" description="use lidar"/>
    <arg name="lidar_model" default="hokuyo" />
    
    <arg name="vehicle_control_topic" default="/jetracer/cmd_drive" description="final command to vehicle"/>
    <arg name="autonomous_control_cmd" default="/autonomous/cmd_drive" description="autonomous ackermann control command"/>
    
    <arg name="rosbag_trigger_topic" default="/rosbag2_recorder/trigger" />
    <arg name="rosbag_memo_topic" default="/rosbag2_recorder/memo" />
    <arg name="lidar_container_name" default="lidar_container" />
    
    <arg name="teleop_param" default="$(find-pkg-share system_launch)/config/tools/teleop.param.yaml" />
    <arg name="bag_manager_param" default="$(find-pkg-share system_launch)/config/tools/bag_manager.param.yaml" />
    <arg name="vehicle_param" default="$(find-pkg-share system_launch)/config/vehicle/jetracer_node.param.yaml" />
    <arg name="filter_param" default="$(find-pkg-share system_launch)/config/sensing/scan_filter.param.yaml" />

    <!-- Jetracer Driver Node -->
    <include file="$(find-pkg-share jetracer_node)/launch/jetracer.launch.xml">
        <arg name="jetracer_param" value="$(var vehicle_param)"/>
        <arg name="input_control_cmd" value="$(var vehicle_control_topic)"/>
    </include>

    <!-- Teleop Manager Node -->
    <include file="$(find-pkg-share teleop_manager)/launch/teleop.launch.xml">
        <arg name="teleop_param" value="$(var teleop_param)"/>
        <arg name="autonomous_control_topic" value="$(var autonomous_control_cmd)"/>
        <arg name="vehicle_control_topic" value="$(var vehicle_control_topic)"/>
        <arg name="trigger_topic" value="$(var rosbag_trigger_topic)"/>  
        <arg name="memo_topic" value="$(var rosbag_memo_topic)"/>
    </include>

    <!-- Sensor Kit Nodes -->
    <include file="$(find-pkg-share sensor_kit_launch)/launch/sensor_kit.launch.xml">
        <arg name="use_lidar" value="$(var use_lidar)"/>
        <arg name="lidar_model" value="$(var lidar_model)"/>
        <arg name="lidar_container_name" value="$(var lidar_container_name)"/>
        <arg name="filter_param" value="$(var filter_param)"/>
    </include>

    <!-- Rosbag2 Recorder Node -->
    <group if="$(var record)">
        <include file="$(find-pkg-share bag_manager_py)/launch/bag_manager.launch.xml">
            <arg name="bag_manager_param" value="$(var bag_manager_param)"/>
            <arg name="trigger_topic" value="$(var rosbag_trigger_topic)"/>
            <arg name="memo_topic" value="$(var rosbag_memo_topic)"/>
        </include>
    </group>

</launch>